<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61317191-1', 'auto');
  ga('send', 'pageview');

</script>
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Udi Cohen's blog</title>
	
	<meta name="author" content="Udi Cohen">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">



	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/udinic">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/udinic">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a class="navbar-brand" href="/">
				<img src="http://www.gravatar.com/avatar/107169775092a3ef4ae94fad5695613a?s=35" class="img-circle" />
				
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
 		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/archives">Archives</a></li>
				<li><a href="/about">About</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
<!-- 	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>
 -->
	<div class="col-sm-3 sidebar hidden-xs">
		<! -- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<i class="fa fa-cube" ></i>
	</a>

</header>

<div class="text-center sidebar-title">
	UDI COHEN
</div>	


<div class="text-center sidebar-bio">
	My adventures
</div>


	<!-- <i class="fa fa-square"></i> -->

<div class="text-center sidebar-links">
	<a href="/">Home</a>
	| 
	<a href="/archives">Archives</a>	
	|
	<a href="/about">About</a>
</div>

<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm twitter" href="https://twitter.com/udinic">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm github" href="https://github.com/udinic">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		
		<li>
			<a class="btn btn-default btn-sm linkedin" href="https://linkedin.com/in/udinic">
				<i class="fa fa-linkedin fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm rss" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<! -- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3 main-content">
		<div class="page-header">
  <h1>Udi Cohen's blog </h1>
</div>


  
<article class="home">

  <span class="post-date">
    
    May
    16th,
    
    2013
  </span>

  <h2>
    <a href="/2013/05/16/create-a-secret-doorway-to-your-app/">Create a secret doorway to your app</a>
  </h2>

  <div>
    
    
       <p>This short post will be about creating a back-door to your app, giving you the option to provide more information or actions than you want end users to have. This will be using the Secret Code feature.</p>

<p>I came across some articles with list of codes in order to access some phone’s data (i.e. Camera’s firmware spec.), run some tests (i.e. Vibration test) or even perform actions such as reset to factory settings. Some examples can be found <a href="http://www.redmondpie.com/hidden-android-secret-codes-for-samsung-htc-motorola-sony-lg-and-other-devices/">here</a> and <a href="http://www.itworld.com/consumerization-it/351248/debug-your-phone-these-hidden-android-secret-codes">here</a> and even as <a href="https://play.google.com/store/apps/details?id=cx.makaveli.androidsecretcodes&amp;hl=en">an app</a> that indexes all that information.</p>

<h2 id="create-your-own">Create your own</h2>

<p>Creating your own secret doorway for your app can help you get more information from users of your app in a time of need. Getting crash reports from end users can be done by several services such as ACRA or BugSense, but how about errors that are not crashes? How many times did your Mom/Spouse/Friend/Mailman showed you their phone, running your app, and said something like: “Why do I see duplicates on the list here?! Why can’t I sync??”. You probably can’t do anything without debugging the app or at least take a look at the app’s SharedPrefs/SQLiteDB. Using a backdoor can help you get more internal information that will help you find the cause for the problem, no computer is necessary!</p>

<p>Another cool thing is providing more actions to do with your app. You want to keep the app clean for your users, but you might want more power to yourself. You can tweak your internal settings, whether for testing purposes or just to try out new features on your everyday use. Not needing to compile a new version after each change of internal setting, can help a lot in the task of identifying tricky problems.</p>

<h2 id="examples">Examples</h2>

<p>Before learning how you can create your own secret code to do some cool stuff, let’s review some use cases that you can use it for:</p>

<ul>
  <li>
    <p>Diagnose information - Presenting technical details of you app, such as generated UUID that can be used to find relevant server data.</p>
  </li>
  <li>
    <p>Send internal data outside - You can dump app information, such as the SharedPrefs/DB data, and send it to you via email. Since this code runs on the same process as your app - you have access to everything!</p>
  </li>
  <li>
    <p>Change settings - You can change the internal settings of your app. Showing more debug logs, communicating with a different server or even change the sorting order of the list you present the user. Anything that can help you understand more about the current situation of the app.</p>
  </li>
  <li>
    <p>Demo mode - Need to show your app to investors? Showoff to your Friends? You can create shortcuts to some app features that are relatively difficult to simulate. For example: Notification that triggers every morning or when the phone is idle for more than 30mins. Maybe a SMS/phone-call triggered action, QR code scan or a sensor’s incoming data. You can create a demo screen to start everything you want to show on the app, and with sample data to make a neat presentation.</p>
  </li>
</ul>

<h2 id="how">How?</h2>

<p>Let’s see how to create one of our own secret code:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;receiver</span> <span class="na">android:name=</span><span class="s">".receiver.DiagnoserReceiver"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;intent-filter&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.provider.Telephony.SECRET_CODE"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;data</span> <span class="na">android:scheme=</span><span class="s">"android_secret_code"</span> <span class="na">android:host=</span><span class="s">"111222"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/receiver&gt;</span></code></pre></figure>

<p>That’s what you put on your manifest. Looks simple right? All we do is provide a listener to a secret code, defined in a &lt;data&gt; tag as the “android:host” attribute, and declare a receiver for it. On the receiver, we can just run some code, open an Activity, run a Service etc. Here’s an example of a receiver that starts a new Activity:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DiagnoserReceiver</span> <span class="kd">extends</span> <span class="nc">BroadcastReceiver</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nc">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="s">"android.provider.Telephony.SECRET_CODE"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">intent</span><span class="o">.</span><span class="na">getAction</span><span class="o">()))</span> <span class="o">{</span>
            <span class="nc">Intent</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="nc">Intent</span><span class="o">.</span><span class="na">ACTION_MAIN</span><span class="o">);</span>
            <span class="n">i</span><span class="o">.</span><span class="na">setClass</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="nc">Diagnoser</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="n">i</span><span class="o">.</span><span class="na">setFlags</span><span class="o">(</span><span class="nc">Intent</span><span class="o">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span><span class="o">);</span>
            <span class="n">context</span><span class="o">.</span><span class="na">startActivity</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
	 <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>We create an intent with the Activity class, Diagnoser, and start it. That activity will run on the same process as our app, allowing us to access all the data that our app has, using all the permissions that our app has been granted with.</p>

<h2 id="use-it">Use it</h2>

<p>To start our diagnose screen, all you need to do is go to the phone’s <strong>stock</strong> dialer (third party dialers not always work with secret codes) and dial the secret code you defined in the “android:host” attribute on the manifest, in the following pattern: “<em>#</em>#<secret-code>#*#*. In our example, you'll need to dial *#*#111222#*#*, the DiagnoserReceiver will receive the intent and start the Diagnoser activity.</secret-code></p>

<p>That’s it. I hope this post helped you get more from your app. If you have more ideas for use cases for this feature - write them on the comments to help us all exploit this nice feature.</p>

       
    
    
  </div>

</article>

  
<article class="home">

  <span class="post-date">
    
    April
    24th,
    
    2013
  </span>

  <h2>
    <a href="/2013/04/24/write-your-own-android-authenticator/">Write your own Android Authenticator</a>
  </h2>

  <div>
    
    
       <p>When I wrote Any.DO’s sync system, about 18 months ago, I wanted to use the built in <em>AccountManager</em> API to authenticate and store the users’ credentials. When I used it to access Google accounts it seems a pretty simple experience, so I thought I should do that for Any.DO as well. It also goes very well with a sync mechanism (using a SyncAdapter), making it the perfect solution. The problem - no good documentation was out there. The developers community didn’t have much experience with that back then, and since we didn’t have much time to figure out issues that could arise from this “No man’s land”, a decision was made to use other methods.</p>

<p>But times have changed..</p>

<p>I recently studied that feature again for a project I’m working on, and saw there’s a huge improvement with the knowledge about it. Besides the better documentation on the <a href="http://developer.android.com/training/id-auth/custom_auth.html">Android.com</a> site, <a href="http://www.finalconcept.com.au/article/view/android-account-manager-step-by-step-2">more</a> and <a href="http://www.c99.org/2010/01/23/writing-an-android-sync-provider-part-1/">more</a> tutorials went out to the wild, feeding us with knowledge about the mysteries of the notorious Account Manager. Some tales were told about the road to create your own account. I read pretty much <strong>all of them. </strong></p>

<p>But..they all still miss something.</p>

<p>I didn’t feel that I actually know everything I wanted to know about the process, and some parts weren’t clear enough. So I did what I usually do when I want to know everything about something - investigate it “<a href="http://en.wikipedia.org/wiki/Jack_Bauer">Jack Bauer</a> style”! This post is the in-depth conclusion of my journey, with all the quirks and features that this service provides and I thought was important enough to find out. There will be a followup post about Sync Adapters as well, so I recommend RSS/Twitter subscribing to be notified…if you’re into this kind of stuff. I’ve been pretty thorough learning all those features, not just the basic stuff as all other tutorials did, but if I forgot something - please let me know by commenting this post.</p>

<h2 id="why-account-manager">Why Account Manager?</h2>

<p>Why really?</p>

<p>Why not just write a simple sign-in form, implement a submit button that post the info to the server and return an auth token? The reason for that is the extra features you get and in the small details that you don’t always cover. All those “corners” that developers often miss when they need their users to sign-in, or dismiss by saying “This will happen to 1 out of 100000 users! It’s nothing!”. What happens if the user changes the password on another client? Has an expired auth-token? Runs a background service that doesn’t have a UI the user can interact with? Wants the convenience of logging-in once and get automatically authenticated on all account-related app (like all Google’s apps do)?</p>

<p>Reading this article will probably make you think it’s complicated stuff, but it’s not! Using the Account Manager actually <strong>simplifies</strong> the authentication process for most cases, and since I’m already giving you a working code sample - why not use it :)</p>

<p>So, to recap the benefits:</p>

<p>Pros: Standard way to authenticate users. Simplifies the process for the developer. Handles access-denied scenarios for you. Can handle multiple token types for a single account (e.g. Read-only vs. Full-access). Easily shares auth-tokens between apps. Great support for background processes such as SyncAdapters. Plus, you get a cool entry for your account type on the phone’s settings:</p>

<p><img src="/assets/images/2013-04-24-write-your-own-android-authenticator/accounts2.png" alt="accounts2" /></p>

<p>Look mom, my name is on the settings screen!</p>

<p><br /></p>

<p>Cons: Requires learning it. But hey, that’s what you’re here for, isn’t it?</p>

<p>The steps we’ll performs to get this done:</p>

<ol>
  <li>
    <p>Creating our Authenticator - the brain behind this operation</p>
  </li>
  <li>
    <p>Creating the Activities - in those the user will enter his credentials</p>
  </li>
  <li>
    <p>Creating the Service - through it we can communicate with the authenticator</p>
  </li>
</ol>

<p>But first, some definitions.</p>


       
          <a class="btn-default btn" href="/2013/04/24/write-your-own-android-authenticator/">Read more --> </a>
       
    
    
  </div>

</article>

  
<article class="home">

  <span class="post-date">
    
    March
    13th,
    
    2013
  </span>

  <h2>
    <a href="/2013/03/13/activity-split-animation/">Activity Split Animation</a>
  </h2>

  <div>
    
    
       <p>This week I had the time to write a small and cool transition animation between Activities.</p>

<p>The regular transition animations between activities animate the Activity as a whole. I wanted to create an animation that split Activity A into 2 parts, animate them in the way out and revealing Activity B. Here’s a gif that illustrate this:</p>

<p><a href="/assets/images/2013-03-13-activity-split-animation/split_anim3.gif"><img src="/assets/images/2013-03-13-activity-split-animation/split_anim3.gif" alt="split_anim3" /></a></p>

<p>The idea is fairly simple:</p>

<ol>
  <li>Save Activity A as a bitmap</li>
  <li>Split bitmap into 2 parts</li>
  <li>Pass the 2 bitmaps to Activity B</li>
  <li>Show the bitmaps on top of Activity B’s layout</li>
  <li>Animate the bitmaps outwards</li>
  <li>User is now seeing Activity B</li>
</ol>

<p>The implementation was not as straightforward as I thought. I ran into some difficulties on the way, but I found solutions to all the problems I encountered. Let’s go step by step.</p>

<p><strong>Note</strong>: This implementation requires holding a snapshot bitmap of the entire screen. For some devices that might be a very expensive operation due to low memory and/or large screen area. If you choose to use this animation - do it with care and don’t overuse it.</p>

<h2 id="save-as-bitmap">Save as Bitmap</h2>

<p>In order to get a bitmap of the Activity, we can use this code:</p>

<p>[sourcecode language=”java”]
View root = currActivity.getWindow().getDecorView().findViewById(android.R.id.content);
root.setDrawingCacheEnabled(true);
Bitmap bmp = root.getDrawingCache();
[/sourcecode]</p>

<p>On the first line, we get the root view for the activity. We find the view with the id of  _android.R.id.content, _which is the FrameLayout that exist on every layout and contains the layout you put on setContentView(). Here’s how it looks on <a href="http://developer.android.com/tools/help/hierarchy-viewer.html">HierarchyViewer</a>:</p>

<p><a href="/assets/images/2013-03-13-activity-split-animation/image14.png"><img src="/assets/images/2013-03-13-activity-split-animation/image_thumb14.png" alt="image" /></a></p>

<p>In order to get a bitmap of the root view, or any view for that matter, we call the <a href="http://developer.android.com/reference/android/view/View.html#getDrawingCache(boolean)">getDrawingCache()</a> method. This will return the cached bitmap of this view in case we have enabled the caching for it. That’s why we also call the <a href="http://developer.android.com/reference/android/view/View.html#setDrawingCacheEnabled(boolean)">setDrawingCacheEnabled</a>() before that. If there isn’t a cached bitmap for the view – it’s been created on the spot.</p>

<h2 id="split-the-bitmap">Split the Bitmap</h2>

<p>In order to split the bitmap, I wrote this code:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Bitmap</span> <span class="n">mBmp1</span> <span class="o">=</span> <span class="nc">Bitmap</span><span class="o">.</span><span class="na">createBitmap</span><span class="o">(</span><span class="n">bmp</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">bmp</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(),</span> <span class="n">splitYCoord</span><span class="o">);</span>
<span class="nc">Bitmap</span> <span class="n">mBmp2</span> <span class="o">=</span> <span class="nc">Bitmap</span><span class="o">.</span><span class="na">createBitmap</span><span class="o">(</span><span class="n">bmp</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">splitYCoord</span><span class="o">,</span> <span class="n">bmp</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(),</span> <span class="n">bmp</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">-</span> <span class="n">splitYCoord</span><span class="o">);</span></code></pre></figure>

<p>_bmp _is the main Bitmap for the entire Activity.
_splitYCoord _is the Y coordinate of the splitting point.</p>

<p>I create 2 smaller bitmaps. mBmp1 is the upper part of the larger bitmap and mBmp2 is the bottom part. Each part’s height is determined by the splitYCoord.</p>

<h2 id="pass-the-bitmaps-to-the-next-activity">Pass the bitmaps to the next Activity</h2>

<p>After I have the 2 bitmaps, I want to start the next Activity and put them on top of its layout. That way the user will see Activity A’s layout where in fact we already moved on to Activity B.</p>

<p>At first, I wanted to pass them as <a href="http://developer.android.com/reference/android/content/Intent.html#putExtra(java.lang.String, android.os.Parcelable)">Extras</a> of the Intent, it’s possible since Bitmap is <a href="http://developer.android.com/reference/android/os/Parcelable.html">Parcelable</a> . The problem is the bitmaps are too large to transport in an Intent, due to size limitation for IPCs. This is the error I got:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"> <span class="o">!!!</span> <span class="no">FAILED</span> <span class="no">BINDER</span> <span class="no">TRANSACTION</span> <span class="o">!!!</span></code></pre></figure>

<p>There are few workarounds for this, including writing the bitmaps into a file and then read them back on the other end. I found the easiest and fastest way will be to just keep them as data members in a common area. I created a static class to contain the bitmaps and all the logic to create and animate them. More on that later.</p>

<h2 id="show-the-bitmaps-on-activity-b">Show the bitmaps on Activity B</h2>

<p>After I start Activity B, disabling any default activity animation using <a href="http://developer.android.com/reference/android/app/Activity.html#overridePendingTransition(int, int)">overridePendingTransition</a>(), I create 2 ImageViews to contain the previously created bitmaps, and presenting them on screen. I do that before calling _setContentView() _to avoid seeing Activity B’s layout ahead of time.</p>

<p>The ImageViews are added directly to the Window of the activity. This allows the ImageViews be on top of the soon-to-be inflated layout and gives more flexibility when deciding the location of each one of them on the screen.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">ImageView</span> <span class="n">imageView</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ImageView</span><span class="o">(</span><span class="n">destActivity</span><span class="o">);</span>
<span class="n">imageView</span><span class="o">.</span><span class="na">setImageBitmap</span><span class="o">(</span><span class="n">bmp</span><span class="o">);</span>

<span class="nc">WindowManager</span><span class="o">.</span><span class="na">LayoutParams</span> <span class="n">windowParams</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WindowManager</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">();</span>
<span class="n">windowParams</span><span class="o">.</span><span class="na">gravity</span> <span class="o">=</span> <span class="nc">Gravity</span><span class="o">.</span><span class="na">TOP</span><span class="o">;</span>
<span class="n">windowParams</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">loc</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="n">windowParams</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">loc</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="n">windowParams</span><span class="o">.</span><span class="na">height</span> <span class="o">=</span> <span class="nc">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">WRAP_CONTENT</span><span class="o">;</span>
<span class="n">windowParams</span><span class="o">.</span><span class="na">width</span> <span class="o">=</span> <span class="nc">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">WRAP_CONTENT</span><span class="o">;</span>
<span class="n">windowParams</span><span class="o">.</span><span class="na">flags</span> <span class="o">=</span>
                <span class="nc">WindowManager</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">FLAG_LAYOUT_IN_SCREEN</span><span class="o">;</span>
<span class="n">windowParams</span><span class="o">.</span><span class="na">format</span> <span class="o">=</span> <span class="nc">PixelFormat</span><span class="o">.</span><span class="na">TRANSLUCENT</span><span class="o">;</span>
<span class="n">windowParams</span><span class="o">.</span><span class="na">windowAnimations</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="n">destActivity</span><span class="o">.</span><span class="na">getWindowManager</span><span class="o">().</span><span class="na">addView</span><span class="o">(</span><span class="n">imageView</span><span class="o">,</span> <span class="n">windowParams</span><span class="o">);</span></code></pre></figure>

<p>Pretty straightforward.</p>

<p>The gravity states where we’ll put our layout in the window. Since we calculated the X,Y position of the bitmaps relative to the top of the screen – we’ll set the gravity to TOP.</p>

<h2 id="animate-the-bitmaps">Animate the bitmaps</h2>

<p>After we created and positioned the bitmaps on Activity B, we can call <em>setContentView</em>() to inflate the Activity’s layout. After the layout is inflated we can start the animation that pushes the 2 bitmaps outwards, thus revealing the Activity’s layout.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">mSetAnim</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AnimatorSet</span><span class="o">();</span>
<span class="n">mTopImage</span><span class="o">.</span><span class="na">setLayerType</span><span class="o">(</span><span class="nc">View</span><span class="o">.</span><span class="na">LAYER_TYPE_HARDWARE</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
<span class="n">mBottomImage</span><span class="o">.</span><span class="na">setLayerType</span><span class="o">(</span><span class="nc">View</span><span class="o">.</span><span class="na">LAYER_TYPE_HARDWARE</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
<span class="n">mSetAnim</span><span class="o">.</span><span class="na">addListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">Animator</span><span class="o">.</span><span class="na">AnimatorListener</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAnimationEnd</span><span class="o">(</span><span class="nc">Animator</span> <span class="n">animation</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">clean</span><span class="o">(</span><span class="n">destActivity</span><span class="o">);</span>
                    <span class="o">}</span>

                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAnimationCancel</span><span class="o">(</span><span class="nc">Animator</span> <span class="n">animation</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">clean</span><span class="o">(</span><span class="n">destActivity</span><span class="o">);</span>
                    <span class="o">}</span>
						<span class="o">...</span>
                <span class="o">});</span>

<span class="c1">// Animating the 2 parts away from each other</span>
<span class="nc">Animator</span> <span class="n">anim1</span> <span class="o">=</span> <span class="nc">ObjectAnimator</span><span class="o">.</span><span class="na">ofFloat</span><span class="o">(</span><span class="n">mTopImage</span><span class="o">,</span> <span class="n">translationY</span><span class="o">,</span> <span class="n">mTopImage</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span>
<span class="nc">Animator</span> <span class="n">anim2</span> <span class="o">=</span> <span class="nc">ObjectAnimator</span><span class="o">.</span><span class="na">ofFloat</span><span class="o">(</span><span class="n">mBottomImage</span><span class="o">,</span> <span class="n">translationY</span><span class="o">,</span> <span class="n">mBottomImage</span><span class="o">.</span><span class="na">getHeight</span><span class="o">());</span>

<span class="n">mSetAnim</span><span class="o">.</span><span class="na">setDuration</span><span class="o">(</span><span class="n">duration</span><span class="o">);</span>
<span class="n">mSetAnim</span><span class="o">.</span><span class="na">playTogether</span><span class="o">(</span><span class="n">anim1</span><span class="o">,</span> <span class="n">anim2</span><span class="o">);</span>
<span class="n">mSetAnim</span><span class="o">.</span><span class="na">start</span><span class="o">();</span></code></pre></figure>

<p>The animation is a simple TranslationY animation that moves every ImageView outside the screen, each one to a different directions. I use hardware acceleration (read my <a href="http://udinic.wordpress.com/2013/03/04/android-app-to-the-challenge/">last blog post</a> to learn more about HW accelerated animations) and I do some cleaning after the animation is finished or canceled (removing hardware layer, removing the ImageViews from the window etc.).</p>

<h2 id="how-to-use-my-animation">How to use my Animation</h2>

<p>So I was debating with myself what’s the best way to make it easier to use, without limiting the developer too much. The easiest way was to create a base Activity that the developer can extend and the actions will be taken care of without too much effort. The reason I <strong>didn’t</strong> do that is because I **HATE **extending from other base activities just to get some more features. If your application has it’s own base activity it can be very frustrating if every library will demand you to extend from their own branded Activity.</p>

<p>That’s the reason I created a simple class with static methods that do all the work. here’s the API:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/**
 * Utility class to create a split activity animation
 *
 * @author Udi Cohen (@udinic)
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ActivitySplitAnimationUtil</span> <span class="o">{</span>

    <span class="cm">/**
     * Start a new Activity with a Split animation
     *
     * @param currActivity The current Activity
     * @param intent       The Intent needed tot start the new Activity
     * @param splitYCoord  The Y coordinate where we want to split the Activity on the animation. -1 will split the Activity equally
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">startActivity</span><span class="o">(</span><span class="nc">Activity</span> <span class="n">currActivity</span><span class="o">,</span> <span class="nc">Intent</span> <span class="n">intent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">splitYCoord</span><span class="o">);</span>

    <span class="cm">/**
     * Start a new Activity with a Split animation right in the middle of the Activity
     *
     * @param currActivity The current Activity
     * @param intent       The Intent needed tot start the new Activity
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">startActivity</span><span class="o">(</span><span class="nc">Activity</span> <span class="n">currActivity</span><span class="o">,</span> <span class="nc">Intent</span> <span class="n">intent</span><span class="o">);</span>

    <span class="cm">/**
     * Preparing the graphics on the destination Activity.
     * Should be called on the destination activity on Activity#onCreate() BEFORE setContentView()
     *
     * @param destActivity the destination Activity
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">prepareAnimation</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Activity</span> <span class="n">destActivity</span><span class="o">);</span>

    <span class="cm">/**
     * Start the animation the reveals the destination Activity
     * Should be called on the destination activity on Activity#onCreate() AFTER setContentView()
     *
     * @param destActivity the destination Activity
     * @param duration The duration of the animation
     * @param interpolator The interpulator to use for the animation. null for no interpulation.
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">animate</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Activity</span> <span class="n">destActivity</span><span class="o">,</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">duration</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">TimeInterpolator</span> <span class="n">interpolator</span><span class="o">);</span>

    <span class="cm">/**
     * Start the animation that reveals the destination Activity
     * Should be called on the destination activity on Activity#onCreate() AFTER setContentView()
     *
     * @param destActivity the destination Activity
     * @param duration The duration of the animation
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">animate</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Activity</span> <span class="n">destActivity</span><span class="o">,</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">duration</span><span class="o">);</span>

    <span class="cm">/**
     * Cancel an in progress animation
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">cancel</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>In order to use it, just call this from Activity A when you want to animate to Activity B:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">ActivitySplitAnimationUtil</span><span class="o">.</span><span class="na">startActivity</span><span class="o">(</span><span class="nc">Activity1</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="nc">Activity1</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="nc">Activity2</span><span class="o">.</span><span class="na">class</span><span class="o">));</span></code></pre></figure>

<p>And call this on Activity B’s <em>onCreate</em>():</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// Preparing the 2 images to be split</span>
<span class="nc">ActivitySplitAnimationUtil</span><span class="o">.</span><span class="na">prepareAnimation</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>

<span class="c1">// Setting the Activity's layout</span>
<span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">act_two</span><span class="o">);</span>

<span class="c1">// Animating the items to be open, revealing the new activity.</span>
<span class="c1">// Animation duration of 1 second</span>
<span class="nc">ActivitySplitAnimationUtil</span><span class="o">.</span><span class="na">animate</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="mi">1000</span><span class="o">);</span></code></pre></figure>

<p>That’s it!</p>

<p>No need to extend anything, just 3 simple calls to static methods.</p>

<p>The code supports API14+ but it can easily be converted to work on older devices using <a href="https://github.com/JakeWharton/NineOldAndroids">NineOldAndroid</a>.</p>

<p>The repository is here:</p>

<p><a href="https://github.com/Udinic/ActivitySplitAnimation">https://github.com/Udinic/ActivitySplitAnimation</a></p>

<p>Use it, Fork it, Extend it.</p>

<h2 id="whats-next">What’s next</h2>

<p>There are more things that can be done to extends it:</p>

<ol>
  <li>Vertical splitting – Let the activity split also to the sides.</li>
  <li>Split the activity to more than 2 parts</li>
  <li>You name it!</li>
</ol>

       
    
    
  </div>

</article>

  
<article class="home">

  <span class="post-date">
    
    March
    3rd,
    
    2013
  </span>

  <h2>
    <a href="/2013/03/03/android-app-to-the-challenge/">Android app to the Challenge</a>
  </h2>

  <div>
    
    
       <p>A week ago I gave a talk about Android performance, presenting some old and should-be-known-to-all-developers methods, aside to new tools introduced in Jellybean. The talk was recorded and here’s the video:</p>

<iframe width="560" height="420" allowfullscreen="allowfullscreen" src="http://www.youtube.com/embed/f-C9BJtkfbU?color=white&amp;theme=light"> </iframe>

<p>The slides are <a href="http://www.slideshare.net/udini1/android-app-to-the-challenge">here</a>.</p>

<p>I know that performance optimization tends to be pushed aside when developing a project, especially if you’re in a start-up company and all you do is pretty much “run” with the product.</p>

<p><a href="/assets/images/2013-03-03-android-app-to-the-challenge/performance2.jpg"><img src="/assets/images/2013-03-03-android-app-to-the-challenge/performance2.jpg" alt="performance" /></a></p>

<p>On this post I’ll <strong>give you the tools</strong> **and knowledge **to easily do a performance review and solve common issues in your app, rising it up to the challenge of smooth running.</p>

<p>Let’s start:</p>


       
          <a class="btn-default btn" href="/2013/03/03/android-app-to-the-challenge/">Read more --> </a>
       
    
    
  </div>

</article>

  
<article class="home">

  <span class="post-date">
    
    October
    24th,
    
    2012
  </span>

  <h2>
    <a href="/2012/10/24/android-scripts/">Android Scripts</a>
  </h2>

  <div>
    
    
       <p>As a busy/lazy developer, I always try to automate repeating routines. Those sequence of actions are getting annoying after a few times and always make me gasp. That’s why some of my time is dedicated to writing small scripts to make my life easier, and the development process faster and anger-free. Most of them are very specific to the apps I’m working on, and some are more generic. I’ve pushed them to a <a href="https://github.com/Udinic/AndroidScripts">new repository</a> on GitHub, and it will updated with more scripts when I’ll make some more, or generalize other existing scripts that I use.</p>

<h3 id="adb-batch-scripts">ADB Batch Scripts</h3>

<p>ADB – Android Debug Bridge, is a very powerful tool. You can control a lot of features on the phone. Furthermore, granting yourself with a ROOT access will bring many rewards, as getting files in and out the file-system, manipulating system files and more. I <em>highly</em> recommend rooting your development phone; it’ll prove itself worthy towards the trouble that it might cause in some devices. I’ll also note that the root access from ADB is limited on production builds (stock ROMs) vs. custom ROMs (e.g. Cyanogenmod), so I prefer to just flash a custom ROM on my development phone, making me the master of its domain!</p>

<p>Most of my repeated ADB commands are for DB access. I need to check the app’s SQLite DB to see that my code did everything right. So I wrote this windows batch script:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">adb root
adb pull /data/data/&lt;package name&gt;/&lt;db filename&gt; c:<span class="se">\t</span>emp
<span class="k">if</span> %errorlevel% neq 0 goto :error
start d:<span class="se">\p</span>rograms<span class="se">\S</span>QLite_browser<span class="se">\S</span>QLiteDatabaseBrowser2.0b1.exe c:<span class="se">\t</span>emp<span class="se">\&lt;</span>db filename&gt;
goto :EOF

:error
<span class="nb">echo </span>Error accessing the DB
pause
<span class="nb">exit</span> /b %errorlevel%

:EOF</code></pre></figure>

<p>First, I request to start ADB with root access, not applicable on stock ROMs (as least not easily), and pulling out the DB file to a temp location. The first time running this will show an error, since the _adb root _command restarts the ADB daemon on you computer, which causes the next ADB command not to find the device momentarily. The second time running this will be the charm. To open the DB I use <a href="http://sourceforge.net/projects/sqlitebrowser/">SQLite Browser</a>, which is very simple and lite. Running SQL on the DB is buggy, but for simple table viewing – it’s good enough.</p>

<p>If we want to modify the DB on the device, I wrote a small script to receive any SQL statement, and run it directly on a DB inside the device:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">adb shell sqlite3 /data/data/&lt;package name&gt;/&lt;db filename&gt; %1</code></pre></figure>

<p>Very simple. Using the sqlite3 command, we can get a SQLite prompt that’s running on the device itself. If you don’t have the sqlite3 file in your device, which can happen on stock ROMs mostly, you can use <a href="http://othell.com/wp/?p=48">this nice article</a> that helped me do it on my Galaxy Nexus, or just search Google.</p>

<p>Another common thing I do, is executing specific services and activities, great help for my debugging life. The syntax is simple, but here’s an example to show how easy that it:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">adb shell am startservice <span class="nt">-n</span> &lt;package name&gt;/&lt;Service full class name&gt; <span class="o">[</span>&lt;extras&gt;]
adb shell am start <span class="nt">-n</span> &lt;package name&gt;/&lt;Activity full class name&gt; <span class="nt">-a</span> android.intent.action.MAIN <span class="o">[</span>&lt;extras&gt;]</code></pre></figure>

<p>I can pass extras, action and even activity attributes as clear-top, no-animation and more. I recommend reviewing all the options for those commands, you might get ideas how to automate some of your routines.</p>

<p>Some tests require installing/uninstalling the app to clear the data fast or to test upgrading code. The _adb install _and _adb uninstall _will do the trick here. Very simple to use and fast. I usually install the newest version of <a href="http://any.do">Any.DO</a> on my device using an ADB command, rather than from Google Play. It’s just faster!</p>

<h3 id="python-scripts">Python Scripts</h3>

<p>Using Python, I could write more complex stuff, like analyzing a system dump, pulling only the important information. If you’re familiar with ADB, you probably heard of “<em>adb shell dumpsys”</em>. This command will print a dump of the system, containing LOTS of data about memory allocations, registered receivers, apps permissions and more. You can call “<em>adb shell dumpsys &lt;service name&gt;”</em> to get a specific service’s information. Some examples:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># All the information about accounts on the device</span>
adb shell dumpsys account 

<span class="c"># The battery state</span>
adb shell dumpsys battery

<span class="c"># All the registered alarms on the device</span>
adb shell dumpsys alarm</code></pre></figure>

<p>The problem with the last command – it prints out too much garbage. There are lots of alarms registered on your device at any given moment, and the dump’s printing format is not exactly an eye candy. Since there’s a lot of alarm handling on Any.DO, I needed a clear and easy way to look only at the relevant information. That’s why I wrote this script:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">p</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">Popen</span><span class="p">([</span><span class="sa">r</span><span class="s">'adb'</span><span class="p">,</span> <span class="s">'shell'</span><span class="p">,</span> <span class="s">'dumpsys alarm'</span><span class="p">],</span>
                       <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span>
                       <span class="n">shell</span><span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                       <span class="n">cwd</span><span class="o">=</span><span class="s">'C:</span><span class="se">\\</span><span class="s">'</span><span class="p">)</span>
<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">communicate</span><span class="p">()</span>
<span class="n">p</span><span class="p">.</span><span class="n">wait</span><span class="p">()</span>

<span class="n">pp</span> <span class="o">=</span> <span class="n">pprint</span><span class="p">.</span><span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">lines</span><span class="o">=</span> <span class="n">out</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="n">alerts</span> <span class="o">=</span> <span class="p">[[</span><span class="s">"RTC TYPE"</span><span class="p">,</span> <span class="s">"When"</span><span class="p">,</span> <span class="s">"Repeat"</span><span class="p">,</span> <span class="s">"pkg"</span><span class="p">,</span> <span class="s">"Type"</span><span class="p">]]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="s">" "</span><span class="p">,</span><span class="s">""</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="s">"RTC"</span><span class="p">:</span>

        <span class="c1"># Extract the information we
</span>        <span class="n">rtc_type</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">strip</span><span class="p">().</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">when</span><span class="o">=</span><span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'when=([0-9a-z+]*)'</span><span class="p">,</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">repeat</span><span class="o">=</span><span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'repeatInterval=([0-9a-z+])*'</span><span class="p">,</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">intentType</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="s">"PendingIntentRecord{(\w+) ([\w\.]+) (\w+)"</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># If the user has passed a package name as an argument
</span>        <span class="c1"># we'll filter all other packages' alarms
</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">intentType</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">alerts</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">rtc_type</span><span class="p">,</span> <span class="n">when</span><span class="p">,</span> <span class="n">repeat</span><span class="p">,</span> <span class="n">intentType</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">intentType</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alerts</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">rtc_type</span><span class="p">,</span> <span class="n">when</span><span class="p">,</span> <span class="n">repeat</span><span class="p">,</span> <span class="n">intentType</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">intentType</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

<span class="n">out_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">""</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">alerts</span><span class="p">)</span>

<span class="c1"># Format the data nicely to columns
</span><span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alerts</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>

    <span class="k">for</span> <span class="n">alert_index</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alerts</span><span class="p">)):</span>
        <span class="n">out_lines</span><span class="p">[</span><span class="n">alert_index</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">alerts</span><span class="p">[</span><span class="n">alert_index</span><span class="p">][</span><span class="n">column</span><span class="p">])</span>

    <span class="n">line_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">out_lines</span><span class="p">))</span> <span class="o">+</span> <span class="mi">5</span>

    <span class="k">for</span> <span class="n">alert_index</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alerts</span><span class="p">)):</span>
        <span class="n">out_lines</span><span class="p">[</span><span class="n">alert_index</span><span class="p">]</span> <span class="o">+=</span> <span class="s">" "</span> <span class="o">*</span> <span class="p">(</span><span class="n">line_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_lines</span><span class="p">[</span><span class="n">alert_index</span><span class="p">]))</span>

<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">out_lines</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">l</span></code></pre></figure>

<p>All I do here, is getting the output from the command “<em>adb dumpsys alarms”</em>, and extract the information I need the most:</p>

<ol>
  <li><a href="http://developer.android.com/reference/android/app/AlarmManager.html#RTC">RTC</a> type.</li>
  <li>When will the alarm go off.</li>
  <li>The repeat interval of the alarm, if there is one.</li>
  <li>The intent type that the alarm will invoke. Could be a Service, Activity or a Broadcast.</li>
</ol>

<p>Here’s an example output:</p>

<p><a href="/assets/images/2012-10-24-android-scripts/image3.png"><img src="/assets/images/2012-10-24-android-scripts/image_thumb3.png" alt="image" /></a></p>

<p>Passing the package name as an argument will print only its relevant alarms.</p>

<p>Another issue I encountered was activities’ stack handling. All those activities’ attributes, “singleTop”, “singleInstance” and more, can get you utterly confused about what would happen when you press the back button. Will you be navigated to the previous activity? will you be thrown to your main activity? or is it to the launcher screen? <a href="http://http://developer.android.com/guide/components/tasks-and-back-stack.html">Reading the documentation</a> will help you understand what **should **be, and using my “Activity stack viewer” will help you see what **is **happening back there. This script is parsing the dumpsys, as the previous script did, and prints the activities’ stack grouped by their package name:</p>

<p><a href="/assets/images/2012-10-24-android-scripts/image4.png"><img src="/assets/images/2012-10-24-android-scripts/image_thumb4.png" alt="image" /></a></p>

<p>Here I can see that on the Twitter app, I opened the post activity from the home activity. I see all the other paused activities that haven’t been destroyed yet by the operation system. Passing a package name as an argument will print a filtered list;</p>

<p>That’s all for now. I hope I helped at least some of you to do things a little bit more efficient. I’ll keep that <a href="https://github.com/Udinic/AndroidScripts">GitHub repository</a> updated with new scripts I’ll write in the future. If you have a script to contribute – go ahead and submit a PR!</p>

       
    
    
  </div>

</article>

  
<article class="home">

  <span class="post-date">
    
    October
    9th,
    
    2012
  </span>

  <h2>
    <a href="/2012/10/09/compiling-some-memories/">Compiling some memories</a>
  </h2>

  <div>
    
    
       <p>This week I decided to <a href="https://github.com/Udinic/FAT32-Sorter">publish the code</a> from an old project I did couple of years ago, the <strong>FAT32 Sorter</strong>. I wrote a little about it in <a href="http://udinic.wordpress.com/2011/10/24/fat32-sorter/">here</a>, and a lot about it in <a href="http://www.codeproject.com/Articles/95721/FAT-32-Sorter">there</a>. As I went through the code, make final adjustments before releasing it to the wild, I saw other old projects of mine. Just by reading those folder names, my mind has started reciting the story behind each and one of them.</p>

<p>Ah… memories…</p>

<p>When I started coding, around the age of 14, I wasn’t attracted to write small games, as my classmates were doing from time to time. I wanted to solve problems that I find myself get annoyed by, or to make stuff easier for me. So whenever I got frustrated by something, I immediately started thinking – “How can I create a better experience?”.</p>

<p>And I did.</p>

<p>I decided to release another project to the open source community. Before I’ll introduce it –I’ll explain the story behind it: As a heavy Windows user, I tried to tweak it as much as I can, making the glove better fit my hand. I wanted to enable the “Hide extension for knows file types” property. This helps me rename the file name without messing with its extension. But, I also wanted to be able to rename the file’s extension easily (Yes! I did rename extensions quite often. How did you write .BAT files if not from a .TXT file?!). Since Windows’ file properties didn’t give an option to edit the extension, I created <strong>RenameExt</strong>, which adds a context menu option for that:</p>

<p><a href="/assets/images/2012-10-09-compiling-some-memories/right_click1.png"><img src="/assets/images/2012-10-09-compiling-some-memories/right_click_thumb1.png" alt="right_click" /></a></p>

<p>The new option raises a minimal dialog to do the operation I needed</p>

<p><a href="/assets/images/2012-10-09-compiling-some-memories/ext_dlg1.png"><img src="/assets/images/2012-10-09-compiling-some-memories/ext_dlg_thumb1.png" alt="ext_dlg" /></a></p>

<p>Of course I handled all the cases where you select multiple files, and not necessarily with the same extension. Since Windows Vista, when you rename a file, the file’s extension is excluded from the selection, so it’s easier to rename just the file name. I don’t use RenameExt anymore, but if you want to check out the code – <a href="https://github.com/Udinic/RenameExt">here it is</a>.</p>

<p>Another utility that I wrote, came due to a computer failure, where the only option was to format the hard-drive and start fresh. The problem – I had a big and organized Favorites folder, with all the websites I kept close. Back than, we didn’t have auto-sync to all the favorites, like those spoiled kids have now, so I had to back them up myself. Since I couldn’t get Windows to load, I did that using DOS. The problem: DOS does not support long file names, at least not the DOS I had at that time. This means all the favorites’ titles just got truncated to shit like “HOWSTU~1.url”, which ruins any chance to understand what it links to. The solution: <strong>FavoriteOrganizer</strong>.</p>

<p><a href="/assets/images/2012-10-09-compiling-some-memories/screenshot1.png"><img src="/assets/images/2012-10-09-compiling-some-memories/screenshot_thumb.png" alt="screenshot" /></a></p>

<p>This small utility scans all the .url files, go to the website they refer to, get the title from the HTML file and rename the .url file to that title. It identifies dead links and webhosting service pages, which probably means that this site is no longer exist (Well, excluding some ACTUAL webhosting sites I kept there..). My favorites were saved, only to be completely deleted a few years after that.</p>

<p>There’s also a VB project that I wrote to solve a very specific problem I had with my brother – music. My brother and I have different taste in music, but some genres are common to both of us. To save space, we had one music folder with all the music, but each have his own Winamp playlist with all the songs he listens to. It’s not like today, where I have over 10,000 songs, we had maybe a 100, each and one of them were handpicked. You can’t afford downloading full discographies when you download in a rate of 7 KB/s at best. Downloading new songs and moving them to the common music directory caused a lot of problems, since we forgot to let each other know about new stuff that the other party might find interesting in, causing duplicates and stupid arguments. That’s why I wrote the <strong>SongsOrganizer</strong>:</p>

<p><a href="/assets/images/2012-10-09-compiling-some-memories/songsorgnizer.png"><img src="/assets/images/2012-10-09-compiling-some-memories/songsorgnizer_thumb.png" alt="songsorgnizer" /></a></p>

<p>It’s in Hebrew, but I’ll explain: The screen on the left side presents all the newly downloaded songs that are still in the download folder, waiting to join their friends in the music folder. Currently – there are no songs to transfer. Each user can see the song’s details and even play it. If the current user wants it, he presses the button that says “Transfer song” which causes this chain of events: Moving the song to the music folder, add the song to the current user’s playlist and save this song’s information in the internal DB. When the other user logs in, He can see all the songs the other user has moved, and click on the “I want too” button, which add this songs to his playlist too. <br />
Neat huh? This really made our lives much easier, at least until we each got a computer of his own :).</p>

<p>After a while, I got attracted to mobile development. J2ME was the first platform I learned, followed by Symbian and of course – Android. Using the mobile phone, I could solve a different kind of problems I encountered. The first JAVA supporting device I had was the Nokia 3510i</p>

<p><img src="http://cdn2.gsmarena.com/vv/bigpic/no3510i.gif" alt="http://www.gsmarena.com/nokia_3510i-344.php" /></p>

<p>It was really cool, it even had colored screen! The first problem I solved with it, was reading the menu at dark bars. We all used the light from our mobile devices, but it kept turning off, and was not bright enough. So I thought – why not create an app to light the screen all the time with white color? And that’s how <strong>FlashLight</strong> was born. Couple of months after I released it to the internet, I saw other apps do the same, and now we have dozens of those, but back then – I was the first one. No app stores were exist, so I can’t really know that for sure, but I did my research before that.</p>

<p>I also researched for an idea to create an app to keep all my passwords on my mobile device, and be able to sync them with my computer. I wrote the stuff I need to investigate on this To-Do list I created:</p>

<p><a href="/assets/images/2012-10-09-compiling-some-memories/image.png"><img src="/assets/images/2012-10-09-compiling-some-memories/image_thumb.png" alt="image" /></a></p>

<p>Even back then I was into To-Do lists :) Eventually I didn’t complete this project due to technological difficulties. Today I’m a happy user of KeePass on my PC and Android, and I sync the data using Dropbox. Much easier!</p>

<p>Last but not least, is my University project I did with a close friend of mine. We wrote a chat app called <strong>ChatWithME</strong><strong>,</strong> allowing PC and mobile clients to chat together. We wanted to make something cooler than just a regular server-client chat, so besides writing a beautiful J2ME chat client a person can write in a week, we give the mobile users the option to chat using a server connection or Bluetooth, which saves precious KBs if we want to speak with our classmates during a lecture.</p>

<p><a href="/assets/images/2012-10-09-compiling-some-memories/image1.png"><img src="/assets/images/2012-10-09-compiling-some-memories/image_thumb1.png" alt="image" /></a> <a href="/assets/images/2012-10-09-compiling-some-memories/image2.png"><img src="/assets/images/2012-10-09-compiling-some-memories/image_thumb2.png" alt="image" /></a></p>

<p>We got an A+ for that project.<br />
I also found a few small Symbian apps that I wrote, C# projects and more, but they are less interesting than those are.</p>

<p>Hope you had fun like I did, taking this trip down memory lane. My only takeaway here - make the time to work on the things you love.</p>

       
    
    
  </div>

</article>

  
<article class="home">

  <span class="post-date">
    
    July
    30th,
    
    2012
  </span>

  <h2>
    <a href="/2012/07/30/a-festivus-for-the-rest-of-us/">A Festivus for the REST of us!</a>
  </h2>

  <div>
    
    
       <p>Quite recently, we added a sync feature to Any.DO. The users can sync all their tasks to Any.DO’s server, allowing them to access their tasks from our Android, iOS and Chrome clients.</p>

<p>Our data structure is a classic fit to <a href="http://stackoverflow.com/questions/671118/what-exactly-is-restful-programming">REST API</a> architecture. After getting our server ready, it was now the time to teach the Android client how to “talk the talk”. I didn’t want to use simple HTTP requests, constructed to use our REST API. I wanted to use some library to make my life easy, and my code readable. I also didn’t want to reinvent the wheel, so I did my research. I found some good and simple libraries for Android, as <a href="http://beders.github.com/Resty/Resty/Overview.html">Resty</a>, but then I found a more elegant solution for that – RestAdapter in <a href="https://github.com/square/retrofit">Retrofit</a> by Square.</p>


       
          <a class="btn-default btn" href="/2012/07/30/a-festivus-for-the-rest-of-us/">Read more --> </a>
       
    
    
  </div>

</article>

  
<article class="home">

  <span class="post-date">
    
    July
    23rd,
    
    2012
  </span>

  <h2>
    <a href="/2012/07/23/adding-more-actions-to-jellybean-notifications/">Adding more actions to JellyBean Notifications</a>
  </h2>

  <div>
    
    
       <p>One of most useful features on Android are the Notifications. While iOS just got them – Android keeps improving them. JellyBean has presented some sweet notifications’ features. Larger area, multiline text entry, list of different items and pictures. There’s also an option to create your own custom layout to present there (though I think it potentially can ruin the uniformity of the notifications design). All those “tall” notifications can be also collapsed/expended to save some space. One more thing, and this could be the coolest of all, is the option to add **actions **to the notifications.</p>

<p><img src="/assets/images/2012-07-23-adding-more-actions-to-jellybean-notifications/image_thumb5.png" alt="image" />   <img src="/assets/images/2012-07-23-adding-more-actions-to-jellybean-notifications/image5_thumb.png" alt="image" /></p>

<p>(Sample notifications on JellyBean. Taken using <a href="https://github.com/JakeWharton/NotificationCompat2">NotificationCompat2</a> sample app, by Jake Wharton)</p>

<p>Three actions don’t (always) make it right.</p>

<p>Each notification can suggest <strong>up to 3 actions</strong>, but what if I want <strong>more</strong>? Maybe I want that a click on one action will give some other actions to pick from? I know it’s not a common case, but I can think of several cases where it can be useful. Since all the notifications are built on the same way AppWidgets are built, using RemoteViews, there are not much place for run-time manipulation.</p>

<p>Seems like the <strong>old switch-a-roo</strong> will do the trick here.</p>

<p>Changing the actions is possible by replacing the whole notification with a new one. The replacing notification can have a different title and different actions from the previous one, but it must have the same notification id. This is how it’ll look like:</p>

<p><a href="/assets/images/2012-07-23-adding-more-actions-to-jellybean-notifications/image6.png"><img src="/assets/images/2012-07-23-adding-more-actions-to-jellybean-notifications/image_thumb6.png" alt="image" /></a></p>

<p>How to do that?</p>

<p>First, let’s clarify something – notification’s actions don’t just have an OnClickListener like regular buttons, they fire an Intent using a PendingIntent. A receiver needs to receive that Intent and “notify” the replacing notification to the Android’s Notification Service. The receiver can be a BroadcastReceiver, Service or even an Activity, but we want something that doesn’t take much resources/loading-time (as an Activity) or doesn’t have the potential to be called from other applications (as a BroadcastReveiver). A Service, or even simpler – IntentService, will fit perfectly here.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NotificationReplaceService</span> <span class="kd">extends</span> <span class="nc">IntentService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="no">ACTION_SWITCH_NOTIFICATIONS</span> <span class="o">=</span> <span class="s">"com.jakewharton.notificationcompat2.SWITCH_NOTIFICATIONS"</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="no">SWITCH_NOTIFICATION_ARG_ID</span> <span class="o">=</span> <span class="s">"NOTIF_ID"</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="no">SWITCH_NOTIFICATION_ARG_NOTIFICATION</span> <span class="o">=</span> <span class="s">"NOTIF_NOTIFICATION"</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">NotificationReplaceService</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="s">"NotificationReplaceService"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onHandleIntent</span><span class="o">(</span><span class="nc">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="no">ACTION_SWITCH_NOTIFICATIONS</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">intent</span><span class="o">.</span><span class="na">getAction</span><span class="o">()))</span> <span class="o">{</span>

            <span class="kt">int</span> <span class="n">notifiId</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getIntExtra</span><span class="o">(</span><span class="no">SWITCH_NOTIFICATION_ARG_ID</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span>
            <span class="nc">Notification</span> <span class="n">notification</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getParcelableExtra</span><span class="o">(</span><span class="no">SWITCH_NOTIFICATION_ARG_NOTIFICATION</span><span class="o">);</span>

            <span class="c1">// Creating the new notification based on the data came from the intent</span>
            <span class="nc">NotificationManager</span> <span class="n">mgr</span> <span class="o">=</span> <span class="o">(</span><span class="nc">NotificationManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="no">NOTIFICATION_SERVICE</span><span class="o">);</span>
            <span class="n">mgr</span><span class="o">.</span><span class="na">notify</span><span class="o">(</span><span class="n">notifiId</span><span class="o">,</span> <span class="n">notification</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>This service supports the “SWITCH_NOTIFICATION” action, which has 2 extras:</p>

<ul>
  <li>
    <p>Notification Id: Must be the same as the notification we’re replacing</p>
  </li>
  <li>
    <p>Notification object: The second notification we replace the current notification with</p>
  </li>
</ul>

<p>Luckily for us – the Notification class is <a href="http://developer.android.com/reference/android/os/Parcelable.html">Parcelable</a>, meaning I can pass it as one of the Intent’s extras with no problem.</p>

<p>To illustrate this idea, I used Jake Wharton’s <a href="https://github.com/JakeWharton/NotificationCompat2">NotificationCompat2</a> project, which gives a simple API to build notifications for all Android versions from 1.6 to 4.1. My service was added to the manifest</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">        <span class="c">&lt;!-- Declaring the service --&gt;</span>
        <span class="nt">&lt;service</span> <span class="na">android:name=</span><span class="s">"com.jakewharton.notificationcompat2.NotificationReplaceService"</span><span class="nt">/&gt;</span></code></pre></figure>

<p>I created the first notification, the one to be replaced:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Notification</span> <span class="n">notiMain</span> <span class="o">=</span> <span class="n">getSimple</span><span class="o">(</span><span class="s">"Action with extension"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">addAction</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">sym_def_app_icon</span><span class="o">,</span> <span class="s">"Action"</span><span class="o">,</span> <span class="n">getPendingIntent</span><span class="o">())</span>
        <span class="o">.</span><span class="na">addAction</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">sym_def_app_icon</span><span class="o">,</span> <span class="s">"More.."</span><span class="o">,</span> <span class="n">intentReplaceNotification</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span></code></pre></figure>

<p>The <em>intentReplaceNotification _is the PendingIntent fired when pressing the “More..” action on the notification. This pending intent is the one in charge of calling the _NotificationReplaceService</em> with the replacing notification.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// First - Building the extended notification.</span>
<span class="c1">// This will replace the first one when the "More.." button will be pressed</span>
<span class="nc">Notification</span> <span class="n">notiReplacement</span> <span class="o">=</span> <span class="n">getSimple</span><span class="o">(</span><span class="s">"Actions extended"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">addAction</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">no_icon</span><span class="o">,</span> <span class="s">"udinic1"</span><span class="o">,</span> <span class="n">getPendingIntent</span><span class="o">())</span>
        <span class="o">.</span><span class="na">addAction</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">no_icon</span><span class="o">,</span> <span class="s">"udinic2"</span><span class="o">,</span> <span class="n">getPendingIntent</span><span class="o">())</span>
        <span class="o">.</span><span class="na">addAction</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">no_icon</span><span class="o">,</span> <span class="s">"udinic3"</span><span class="o">,</span> <span class="n">getPendingIntent</span><span class="o">())</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="c1">// Creating the switch notification intent.</span>
<span class="c1">// The receiver will get this and send notiExtended to the NotificationManager, replacing the current one with the same Id</span>
<span class="nc">Intent</span> <span class="n">switchNotificationIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">();</span>
<span class="n">switchNotificationIntent</span><span class="o">.</span><span class="na">setClass</span><span class="o">(</span><span class="nc">SampleActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="nc">NotificationReplaceService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">switchNotificationIntent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="no">ACTION_SWITCH_NOTIFICATIONS</span><span class="o">);</span>
<span class="n">switchNotificationIntent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="no">SWITCH_NOTIFICATION_ARG_ID</span><span class="o">,</span> <span class="n">notifiId</span><span class="o">);</span>
<span class="n">switchNotificationIntent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="no">SWITCH_NOTIFICATION_ARG_NOTIFICATION</span><span class="o">,</span> <span class="n">notiReplacement</span><span class="o">);</span>
<span class="nc">PendingIntent</span> <span class="n">intentReplaceNotification</span> <span class="o">=</span> <span class="nc">PendingIntent</span><span class="o">.</span><span class="na">getService</span><span class="o">(</span><span class="nc">SampleActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">switchNotificationIntent</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span></code></pre></figure>

<p>Here we created the replacing notification, and passing it to the replacing action intent. This intent will start my _NotificationReplaceService, _which will use the intent’s extras to replace the main notification.</p>

<p>All that is left now to do is to notify the main notification to the Android’s Notification Service</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">NotificationManager</span> <span class="n">mgr</span> <span class="o">=</span> <span class="o">(</span><span class="nc">NotificationManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="no">NOTIFICATION_SERVICE</span><span class="o">);</span>
<span class="n">mgr</span><span class="o">.</span><span class="na">notify</span><span class="o">(</span><span class="n">notifiId</span><span class="o">,</span> <span class="n">notiMain</span><span class="o">);</span></code></pre></figure>

<p>And that’s it!</p>

<p>You can check the full code on my <a href="https://github.com/Udinic/NotificationCompat2">GitHub account</a>. Just please do me one favor – don’t abuse this method to create a complex menu in the users’ notification bar, think about your users!</p>

       
    
    
  </div>

</article>

  
<article class="home">

  <span class="post-date">
    
    July
    21st,
    
    2012
  </span>

  <h2>
    <a href="/2012/07/21/upgrade-your-galaxy-nexus-to-jellybean/">Upgrade your Galaxy Nexus to JellyBean</a>
  </h2>

  <div>
    
    
       <p>After seen the new features added to Android 4.1 (A.K.A. Jelly-bean), I immediately started seeking a way to get it into my phone. Waiting for the OTA (Over the Air) update is not acceptable!</p>

<p><img src="http://hothardware.com/newsimages/Item21886/Jelly_Bean.jpg" alt="" /></p>

<p>I didn’t participate the Google I/O convention, which means I didn’t get the new Nexus 7 nor a Galaxy Nexus Device with the JellyBean already preloaded. But, I do have my own Galaxy Nexus with Android 4.0.4, and since I have a Nexus device – it should be fairly easy to flash it in.</p>

<p>It wasn’t that far from the truth.</p>

<p>After reading <a href="http://www.randomphantasmagoria.com/firmware/galaxy-nexus/i9250/">some information</a> about the different firmware the Galaxy Nexus has, I know that there are 2 main variant types: “<strong>takju</strong>” and “<strong>yakju</strong>”, where the first one is found on models bought in the USA, and the other is international. The first JellyBean build that I’ve found is <strong>JRO03C</strong>, but it’s not a full image, but an update to a specific build of Android 4.0.4. That required build was IMM76I and I had IMM76K. Problem.</p>

<p>On a side note: My phone just recently got the Android 4.0.4 OTA, even though this update is out for months now, it appears to be because I have a sub-variant of “yakju”. Since Google manage and support only the “takju” and “yakju” variants, all the sub-variants get updated later. it explains why I just now got my 4.0.4 OTA. Meaning, If you can’t wait for OTAs – get one of those variants on your phone, and you’ll be one of the first to get them! The needed IMM76I build is a “yakju” variant.</p>

<p>So, back to my problem. I needed to have the IMM76I build instead of my IMM76K, in order to apply the JellyBean updated. That image can be found on the <a href="https://developers.google.com/android/nexus/images">Google’s Factory Images for Nexus Devices</a> site, or in <a href="http://goo.im/stock/maguro/stock">goo.im</a>, which also have a massive collection of ROMs for all phones/tablets. After downloading it – I have to flash it to my device. The easiest way I found was to use <a href="http://forum.xda-developers.com/showthread.php?t=1614827">Galaxy Nexus Toolkit</a>, which made my life much easier, even just for rooting purposes. There’s even an option to download the images straight from there, but I haven’t tried it. Just follow the instructions on the Toolkit and on that XDA post to get it done. WARNING: All your data will be deleted on the process, make sure you back up. Also, make sure you have the appropriate device, my device is a GSM, if you have CDMA/LTE, there are other images needed to be download.</p>

<p>After getting the “right” build for me, I only needed to update it with the new JellyBean OTA. After downloading the OTA (can be found in <a href="http://goo.im/stock/maguro/ota">goo.im</a> or <a href="http://www.randomphantasmagoria.com/firmware/galaxy-nexus/i9250/">here</a>) I copied it to my phone, and run it from the Phone’s Recovery. If you don’t have a recovery installed – you can use the Galaxy Nexus Toolkit I presented above. I installed the CWM touch recovery, and it’s very convenient in compare to the non-touch recovery that I used in the past.</p>

<p><a href="/assets/images/2012-07-21-upgrade-your-galaxy-nexus-to-jellybean/image.png"><img src="/assets/images/2012-07-21-upgrade-your-galaxy-nexus-to-jellybean/image_thumb.png" alt="image" /></a></p>

<p>Mission accomplished!</p>

<p>I did a factory reset at the end of it, to get the full new-user-experience, and I got to say – It’s even better than the one on ICS.</p>

<p>Don’t forget to give some quick pressed on the “Android version” line on this “About phone” screen. This will give you a cute picture related to the current Android version. This is the one from the new JellyBean:</p>

<p><a href="/assets/images/2012-07-21-upgrade-your-galaxy-nexus-to-jellybean/image1.png"><img src="/assets/images/2012-07-21-upgrade-your-galaxy-nexus-to-jellybean/image_thumb1.png" alt="image" /></a></p>

<p>All that left to do now is to explore the new API, and find some cool stuff. My next post will be on one of those…</p>

       
    
    
  </div>

</article>

  
<article class="home">

  <span class="post-date">
    
    May
    8th,
    
    2012
  </span>

  <h2>
    <a href="/2012/05/08/sqlite-drop-column-support/">SQLite DROP COLUMN support</a>
  </h2>

  <div>
    
    
       <p>The new Any.DO version was released to beta testers this week. It’s been a long journey..</p>

<p>On the last couple of months I was working hard on that version. Lots of infrastructure changes, Some of them are Database changes, which I hate because then I have to support upgrading from older DB version. It’s irritating to write it, and even more irritating to test it afterwards (no matter how many useful scripts I wrote to make it easier).</p>

<p>In Android we use SQLite Database, and even though it supports many SQL commands as the more functional Databases around (MySql, Oracle…) it lacks a few useful commands. The ALTER TABLE DROP COLUMN is one of the things I miss the most. There were times where I considered leaving a redundant column in the table, just to avoid the whole process of removing it while upgrading :).</p>

<p>The Internet is full with with people asking about alternatives, and some got useful answers in the shape of pseudo code to get the table on its way to salvation. I got myself into a situation where I needed to drop 4 column on 3 different tables. Damn.</p>

<p><img src="http://cdn.memegenerator.net/instances/250x250/20163274.jpg" alt="" /></p>

<p>That’s it, no more excuses! I’m dealing with this once and for all!</p>

<p>From the <a href="http://sqlite.org/faq.html">SQlite’s FAQ page</a>, one must follow these steps to get this done:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">BEGIN</span> <span class="n">TRANSACTION</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TEMPORARY</span> <span class="k">TABLE</span> <span class="n">t1_backup</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t1_backup</span> <span class="k">SELECT</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="k">FROM</span> <span class="n">t1</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">t1</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">t1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t1</span> <span class="k">SELECT</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="k">FROM</span> <span class="n">t1_backup</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">t1_backup</span><span class="p">;</span>
<span class="k">COMMIT</span><span class="p">;</span></code></pre></figure>

<p>The main problem here – not a generic solution. I need to know the list of column I want to keep, instead of just the columns I want to remove. I solved this problem by using the following SQL command:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">PRAGMA</span> <span class="n">table_info</span><span class="p">(</span><span class="k">table_name</span><span class="p">);</span></code></pre></figure>

<p>This will query the list of columns this table has, among with their properties (type, default value etc.). Using this, I wrote a function to get all the columns of a certain table:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getTableColumns</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">columns</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>
    <span class="nc">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="s">"pragma table_info("</span> <span class="o">+</span> <span class="n">tableName</span> <span class="o">+</span> <span class="s">");"</span><span class="o">;</span>
    <span class="nc">Cursor</span> <span class="n">cur</span> <span class="o">=</span> <span class="n">getDB</span><span class="o">().</span><span class="na">rawQuery</span><span class="o">(</span><span class="n">cmd</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>

    <span class="k">while</span> <span class="o">(</span><span class="n">cur</span><span class="o">.</span><span class="na">moveToNext</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">columns</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">cur</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">cur</span><span class="o">.</span><span class="na">getColumnIndex</span><span class="o">(</span><span class="s">"name"</span><span class="o">)));</span>
    <span class="o">}</span>
    <span class="n">cur</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>

    <span class="k">return</span> <span class="n">columns</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<p>Now we can proceed to the the dropColumn() implementation:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">dropColumn</span><span class="o">(</span><span class="nc">SQLiteDatabase</span> <span class="n">db</span><span class="o">,</span>
		<span class="nc">ConnectionSource</span> <span class="n">connectionSource</span><span class="o">,</span>
		<span class="nc">String</span> <span class="n">createTableCmd</span><span class="o">,</span>
		<span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span>
		<span class="nc">String</span><span class="o">[]</span> <span class="n">colsToRemove</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">java</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">SQLException</span> <span class="o">{</span>

	<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">updatedTableColumns</span> <span class="o">=</span> <span class="n">getTableColumns</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
	<span class="c1">// Remove the columns we don't want anymore from the table's list of columns</span>
	<span class="n">updatedTableColumns</span><span class="o">.</span><span class="na">removeAll</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">colsToRemove</span><span class="o">));</span>

	<span class="nc">String</span> <span class="n">columnsSeperated</span> <span class="o">=</span> <span class="nc">TextUtils</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s">","</span><span class="o">,</span> <span class="n">updatedTableColumns</span><span class="o">);</span>

	<span class="n">db</span><span class="o">.</span><span class="na">execSQL</span><span class="o">(</span><span class="s">"ALTER TABLE "</span> <span class="o">+</span> <span class="n">tableName</span> <span class="o">+</span> <span class="s">" RENAME TO "</span> <span class="o">+</span> <span class="n">tableName</span> <span class="o">+</span> <span class="s">"_old;"</span><span class="o">);</span>

	<span class="c1">// Creating the table on its new format (no redundant columns)</span>
	<span class="n">db</span><span class="o">.</span><span class="na">execSQL</span><span class="o">(</span><span class="n">createTableCmd</span><span class="o">);</span>

	<span class="c1">// Populating the table with the data</span>
	<span class="n">db</span><span class="o">.</span><span class="na">execSQL</span><span class="o">(</span><span class="s">"INSERT INTO "</span> <span class="o">+</span> <span class="n">tableName</span> <span class="o">+</span> <span class="s">"("</span> <span class="o">+</span> <span class="n">columnsSeperated</span> <span class="o">+</span> <span class="s">") SELECT "</span>
			<span class="o">+</span> <span class="n">columnsSeperated</span> <span class="o">+</span> <span class="s">" FROM "</span> <span class="o">+</span> <span class="n">tableName</span> <span class="o">+</span> <span class="s">"_old;"</span><span class="o">);</span>
	<span class="n">db</span><span class="o">.</span><span class="na">execSQL</span><span class="o">(</span><span class="s">"DROP TABLE "</span> <span class="o">+</span> <span class="n">tableName</span> <span class="o">+</span> <span class="s">"_old;"</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>So what do we have here?</p>

<p>This function is receiving the <strong>db</strong> and the <strong>connectionSource</strong> as arguments, as for the onUpgrade() method, which is the main entry point for the whole Database upgrading process.
The <strong>createTableCmd</strong> is the “CREATE TABLE… “ command to create the new table. You must have that command in order to create the table on a new installation of the app.
The <strong>tableName</strong> is…well…the name of the table.
The <strong>colsToRemove</strong> is an array of columns we want to remove from the table. We can also easily create a convenient function to receive only a String of one column name.</p>

<p>That’s it! Let the columns’ dropping frenzy begin! You can also use this method to support the missing RENAME COLUMN command. The badly-named columns days are over, no more columns like “task_title_which_is_shared_via_email”. Just rename them!</p>

<p>On my next posts I’ll publish some of my useful scripts to help me develop and test more efficiently.</p>

       
    
    
  </div>

</article>


<ul class="pager"> 

  
  <li class="previous">
    
    <a href="/">&larr; Newer</a>
    
  </li>
  
  
  <li>
    <span class="page_number">Page: 2 of 4</span>
  </li>

  
  <li class="next">
    <a href="/page3">Older &rarr;</a>
  </li>
  

</ul>




		<footer>
			<p>
				&copy; 2025 Udi Cohen with Jekyll. Theme: Customized (based of <a href="https://github.com/dbtek/dbyll">dbyll</a> by dbtek).
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
</body>
</html>

